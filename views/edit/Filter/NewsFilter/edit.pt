<html tal:omit-tag=""
  tal:define="
    view here;
    model request/model;
    root_url model/get_root_url;
    user_role view/get_user_role;
    silva_root view/silva_root;
    results python:model.find_sources();
    startat python:path('request/start | nothing') or path('options/startat | nothing') or 0;
    batch python:modules['ZTUtils'].Batch(results, size=10, start=int(startat));
    sources python:view.prepare_sources(batch);
    previous python:batch.previous;
    next python:batch.next;
    title model/get_title_editable;
    vein string:edit;
    fields view/settingsform/get_fields;
">
<!--    rssfields view/rssform/get_fields; -->

  <table class="columns columns2">
    <tbody>
      <tr>
        <tal:block replace="nothing">
          _____________________ sidebar _____________________
        </tal:block>
        <td class="left"
          tal:define="template_id string:tab_edit">
          <metal:block use-macro="view/macro_vein_navigation/macros/vein" />
        </td>

        <tal:block replace="nothing">
          _____________________ main _____________________
        </tal:block>
        <td class="main">


  <form action="." name="silvaObjects" method="POST">
    <script language="JavaScript">
      <!--

        function switchRssFormVisibility(on) {
            var table = document.getElementById('settingstable');
            var heads = table.getElementsByTagName('thead');
            var bodies = table.getElementsByTagName('tbody');
            if (on) {
                heads[1].style.display = "table-header-group";
                bodies[1].style.display = "table-row-group";
            } else {
                heads[1].style.display = "none";
                bodies[1].style.display = "none";
            };
        };
      
      // -->
    </script>
    <table id="settingstable" class="listing">
      <thead>
        <tal:block replace="nothing">
          ______________ vein + title row ______________
        </tal:block>
        <tr>
          <td class="top"
            colspan="3">
            <h2>
              <img tal:replace="structure python:view.render_icon(model)" />
              <span style="text-transform:lowercase;"
                tal:content="model/meta_type">Meta type</span> 
              &#xab;<tal:block content="model/get_title_or_id" />&#xbb;
              general settings
            </h2>
          </td>
        </tr>
      </thead>

      <!-- ______________ table header ______________ -->
      <tbody>
        <tr>
          <th align="left" width="15%" nowrap="1">Element</th>
          <th align="left" width="40%">Content</th>
          <th align="left">Note</th>
        </tr>

        <!-- ______________ form content ____________ -->
        <tal:block tal:repeat="field fields">
          <tr class="even" tal:attributes="class python: test(repeat['field'].odd(), 'odd', 'even')">
            <td class="field-title">
              <nobr>
                <span tal:replace="field/title">Title</span><span class="warning" tal:condition="field/is_required">*</span>
              </nobr>
            </td>
            <td tal:content="structure field/render">
              Field
            </td>
            <td tal:content="field/description">
              Description
            </td>
          </tr>
        </tal:block>

      </tbody>


      <tfoot>
        <tr class="controls">
          <td class="align-right"
            colspan="4">
            <input class="button" 
              type="submit"
              name="submit_settings:method"
              value=" save settings "
              title="access key: alt-s"
              accesskey="s"
            />
          </td>
        </tr>
      </tfoot>

    </table>
  </form>

  <form action="." name="silvaObjects" method="POST">
    <table class="listing">
      <thead>
        <tal:block replace="nothing">
          ______________ vein + title row ______________
        </tal:block>
        <tr>
          <td class="top"
            colspan="3">
            <h2>
              <img tal:replace="structure python:view.render_icon(model)" />
              &#xab;<tal:block content="model/get_title_or_id" />&#xbb;
              sources
            </h2>
          </td>
        </tr>
      </thead>

      <span tal:replace="nothing"> ______________ table header ______________ </span>
      <tbody>
        <tr tal:condition="python:len(sources) != 0">
          <th align="left" width="3%" nowrap="1">In use</th>
          <th align="left" width="40%">Id</th>
          <th align="left">Title</th>
        </tr>

        <span tal:replace="nothing"> ______________ listing iteration ______________ </span>
        <toc_entry tal:omit-tag=""
          tal:repeat="source sources">
          <tal:define define="obj source/object;
                              id source/index;
                              object_url python:obj.getPath();
                              object obj/getObject;
                              ">
            <cycle tal:define="oddrow repeat/source/odd" tal:omit-tag="">
              <tr class="even"
                tal:attributes="class python:test(oddrow, 'odd', 'even')">

                <span tal:replace="nothing"> _______ checkbox + icon _______ </span>
                <td nowrap="1">
                  <input type="checkbox" name="cb:list" value="value"
                      tal:attributes="value string:cb_${id}; checked source/check_checkbox" />
                  <a href="edit" title="Edit this source"
                      tal:attributes="href string:${object_url}/edit/tab_edit"><img tal:replace="structure python:view.render_icon(object)" /></a>
                </td>

                <span tal:replace="nothing"> _______ id cell _______ </span>
                <td>
                  <a title="Edit this item"
                    tal:attributes="href string:${object_url}/edit"
                    tal:content="object_url">id</a>
                </td>

                <span tal:replace="nothing"> _______ title cell _______ </span>
                <td>
                  <tal:block condition="python:obj.get_title != ''">
                    <span tal:replace="structure string:${obj/get_title}">title</span>
                  </tal:block>
                  <span class="warning" tal:condition="not: source/check_checkbox">
                    &nbsp;(not activated)
                  </span>
                  <tal:block condition="python:obj.get_title == ''">
                    &nbsp;
                  </tal:block>
                </td>

              </tr>

            </cycle>
          </tal:define>
        </toc_entry>

        <span tal:replace="nothing"> ______________ if no records ______________ </span>
        <check tal:condition="python:len(sources) == 0 and not model.get_default()">
          <tr class="focus-light">
            <td colspan="3">
              <i>There are no newssources available.</i>
            </td>
          </tr>
          <tr class="divider">
            <td colspan="3">
              <img tal:attributes="src string:${silva_root}/globals/pixel.gif" width="1" height="1" />
            </td>
          </tr>
        </check>
        <!-- /iteration -->

      </tbody>

      <tfoot>
        <check tal:condition="python:len(sources) != 0">
          <script type="text/javascript">
          // <![CDATA[

            isSelected = false;

            function toggleSelect(button) {
              var form = button.form;
              var check = true;
              if (isSelected) {
                check = false;
                isSelected = false;
              } else {
                isSelected = true;
              };
              var inputs = form.getElementsByTagName('input');
              for (var i=0; i < inputs.length; i++) {
                var child = inputs[i];
                var type = child.getAttribute('type');
                if (type != 'radio' && type != 'checkbox') {
                  continue;
                };
                if (check) {
                  child.setAttribute('checked', true);
                  button.setAttribute('value', 'deselect all');
                } else {
                  // make very sure the checkbox is unchecked, the 
                  // setAttribute works on IE but not on Moz, the 
                  // removeAttribute the other way round, this doesn't
                  // seem to clash and who knows IE 8 will require both ;)
                  child.setAttribute('checked', null);
                  child.removeAttribute('checked');
                  button.setAttribute('value', 'select all');
                };
              };
            };
            
          // ]]>
          </script>

          <span tal:replace="nothing"> ______________ controls for chief ______________ </span>
          <tr class="controls"
            tal:condition="python:user_role == 'Editor'">
            <td colspan="3" class="align-right">
              <script type="text/javascript">
              <!--
              if (document.forms[0]) {
                document.write('<input class="button" type="submit" name="selectButton" value="select all" title="select all items: alt-a" accesskey="a" onClick="toggleSelect(this); return false">')
                }
              //-->
              </script>
              &nbsp;
              <input type="hidden" name="start" tal:attributes="value startat">
              <input class="button" type="submit" name="use_sources:method" value="update sources" title="Use selected sources in this filter: alt-u" accesskey="u" />
            </td>
          </tr>

        </check>
      </tfoot>

    </table>
  </form>

<table width="50%">
  <tr>
    <td width="50%" align="left">
      &nbsp;
      <a href="#" tal:attributes="href string:${model/absolute_url}/edit/tab_edit?start:int=${previous/first}&show_details=${show_details}" tal:condition="previous">Previous</a>
    </td>
    <td width="50%" align="right">
      &nbsp;
      <a href="#" tal:attributes="href string:${model/absolute_url}/edit/tab_edit?start:int=${next/first}&show_details=${show_details}" tal:condition="next">Next</a></td>
  </tr>
</table>

</html>
