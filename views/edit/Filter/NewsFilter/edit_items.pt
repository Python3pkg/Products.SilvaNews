<html tal:omit-tag=""
  tal:define="
    view here;
    model request/model;
    root_url model/get_root_url;
    user_role view/get_user_role;
    silva_root view/silva_root;
    title model/get_title_editable;
    vein string:edit;
    dummy model/security_trigger;
    results python:model.get_all_items();
    startat python:path('request/start | nothing') or path('options/startat | nothing') or 0;
    batch python:modules['ZTUtils'].Batch(results, size=10, start=int(startat));
    objects python:view.prepare_objects(batch);
    previous python:batch.previous;
    next python:batch.next;
    mangle modules/Products/Silva/mangle;
">

  <table class="columns columns2">
    <tbody>
      <tr>
        <tal:block replace="nothing">
          _____________________ sidebar _____________________
        </tal:block>
        <td class="left"
          tal:define="template_id string:tab_edit">
          <metal:block use-macro="view/macro_vein_navigation/macros/vein" />
        </td>

        <tal:block replace="nothing">
          _____________________ main _____________________
        </tal:block>
        <td class="main">

  <form action="." name="silvaObjects" method="POST">

    <table class="listing">
      <thead>
        <tal:block replace="nothing">
          ______________ vein + title row ______________
        </tal:block>
        <tr>
          <td class="top"
            colspan="5">
            <h2>
              <img tal:replace="structure python:view.render_icon(model)" />
              <span style="text-transform:lowercase;"
                tal:content="model/meta_type">Meta type</span> 
              &#xab;<tal:block content="model/get_title_or_id" />&#xbb;
            </h2>
          </td>
        </tr>
      </thead>

      <span tal:replace="nothing"> ______________ table header ______________ </span>
      <tr tal:condition="python:len(objects) != 0">
        <th align="left" width="3%" nowrap="1">In use</th>
        <th align="left" width="1%">Edit</th>
        <th align="left">View</th>
        <th align="left" width="9%">Publish&nbsp;date&nbsp;</th>
        <th align="left" width="9%">Expiration&nbsp;date&nbsp;</th>
      </tr>

      <span tal:replace="nothing"> ______________ listing iteration ______________ </span>
      <toc_entry tal:omit-tag=""
          tal:repeat="object objects">
        <tal:define define="obj python:object['object'].getObject();
                            id object/index;
                            object_status obj/version_status;
                            object_url python: '/'.join(obj.object_path());
                            ">
          <cycle tal:define="oddrow repeat/object/odd" tal:omit-tag="">
            <tr class="odd"
                tal:attributes="class python:test(oddrow, 'odd', 'even')">

              <span tal:replace="nothing"> _______ checkbox + icon _______ </span>
              <td nowrap="1">
                <input type="checkbox" name="cb:list" value="value"
                    tal:attributes="value string:cb_${id}; checked object/check_checkbox" />
                <a href="edit" title="Edit this item"
                  tal:attributes="href string:${object_url}/edit/tab_edit">
                <img tal:replace="structure python:view.render_icon(obj.object())" /></a>
              </td>

              <span tal:replace="nothing"> _______ id cell _______ </span>
              <td>
                <a title="Edit this item"
                  tal:attributes="href string:${object_url}/edit;
                                  class python:view.get_status_style(object_status)"
                  tal:content="python: '/'.join(obj.object().getPhysicalPath())">id</a>
              </td>

              <span tal:replace="nothing"> _______ title cell _______ </span>
              <td>
                <tal:block condition="python:obj.get_title != ''">
                  <a class="blacklink" title="Preview this item"
                    tal:attributes="href string:${object_url}">
                    <b tal:content="string:${obj/get_title}">title</b>
                  </a>
                </tal:block>
                <tal:block condition="object/check_checkbox">
                  &nbsp;(Selected)
                </tal:block>
                <tal:block condition="python:obj.get_title == ''">
                </tal:block>
              </td>

              <span tal:replace="nothing"> _______ publish date cell _______ </span>
              <td>
                <tal:block define="publication_dt python: obj.publication_datetime()">
                  <tal:block condition="publication_dt">
                    <span tal:replace="structure python: mangle.DateTime(publication_dt).toStr()" tal:omit-tag="">21 oct 2001 18:18</span>
                  </tal:block>
                  <tal:block condition="not: publication_dt">
                    None
                  </tal:block>
                </tal:block>
              </td>

              <span tal:replace="nothing"> _______ expiration date cell _______ </span>
              <td>
                <span tal:condition="object_status">
                  <tal:block define="expiration_dt python: obj.expiration_datetime()">
                    <tal:block condition="expiration_dt">
                      <span tal:replace="structure python: mangle.DateTime(expiration_dt).toStr()" tal:omit-tag="">21 oct 2001 18:18</span>
                    </tal:block>
                    <tal:block condition="not: expiration_dt">
                      None
                    </tal:block>
                  </tal:block>
                </span>
                <span tal:condition="not: object_status" tal:omit-tag="">
                  &nbsp;
                </span>
                &nbsp;
              </td>

            </tr>

          </cycle>
          
        </tal:define>
      </toc_entry>

      <span tal:replace="nothing"> ______________ if no records ______________ </span>
      <check tal:condition="python:len(objects) == 0">
        <tr class="divider">
          <td colspan="5"><img tal:attributes="src string:${silva_root}/globals/pixel.gif" width="1" height="1" /></td>
        </tr>
        <tr class="focus-light">
          <td colspan="5">
            There are no publishable objects in this folder.
          </td>
        </tr>
        <tr class="divider">
          <td colspan="5"><img tal:attributes="src string:${silva_root}/globals/pixel.gif" width="1" height="1" /></td>
        </tr>
      </check>
      <!-- /iteration -->


      <check tal:condition="python:len(objects) != 0">
        <script type="text/javascript">
        <!--
          isSelected = false;

          function toggleSelect() {
            if (isSelected == false) {
              for (i = 0; i < document.silvaObjects.length; i++)
                document.silvaObjects.elements[i].checked = true ;
                isSelected = true;
                document.silvaObjects.selectButton.value = "Deselect all";
                return isSelected;
            }
            else {
              for (i = 0; i < document.silvaObjects.length; i++)
                document.silvaObjects.elements[i].checked = false ;
                isSelected = false;
                document.silvaObjects.selectButton.value = "Select all";
                return isSelected;
            }
          }
        //-->
        </script>

        <span tal:replace="nothing"> ______________ controls for chief ______________ </span>
        <tr class="controls"
            tal:condition="python:user_role == 'Editor'">
          <td colspan="5">
            <script type="text/javascript">
            <!--
              if (document.forms[0]) {
                document.write('<input class="button" type="submit" name="selectButton" value="Select all" accesskey="a" title="Select all items on and below this level - alt a" onClick="toggleSelect(); return false">')
                }
            //-->
            </script>
            &nbsp;
            <input type="hidden" name="start" tal:attributes="value startat">
            <input class="button" type="submit" name="use_items:method" value="Update" title="Use selected items in this filter- alt-u" accesskey="u" />
            &nbsp;
          </td>
        </tr>

      </check>

    </table>

  </form>

<table width="50%">
  <tr>
    <td width="50%" align="left">
      &nbsp;
      <a href="#" tal:attributes="href string:${model/absolute_url}/edit/tab_edit?start:int=${previous/first}&show_details=${show_details}" tal:condition="previous">Previous</a>
    </td>
    <td width="50%" align="right">
      &nbsp;
      <a href="#" tal:attributes="href string:${model/absolute_url}/edit/tab_edit?start:int=${next/first}&show_details=${show_details}" tal:condition="next">Next</a></td>
  </tr>
</table>

</html>
