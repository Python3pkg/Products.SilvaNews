<html tal:omit-tag=""
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:notal="http://www.infrae.com/silva/notal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  i18n:domain="silva_news"
  tal:define="
    view here;
    model request/model;
    root_url model/get_root_url;
    user_role view/get_user_role;
    silva_root view/silva_root;
    results python:model.find_sources();
    startat python:path('request/start | nothing') or path('options/startat | nothing') or 0;
    batch python:modules['ZTUtils'].Batch(results, size=10, start=int(startat));
    sources python:view.prepare_sources(batch);
    previous python:batch.previous;
    next python:batch.next;
    title model/get_title_editable;
    vein string:edit;
    fields view/settingsform/get_fields;
">

  <table class="columns columns2">
    <tbody>
      <tr>
        <tal:block replace="nothing">
          _____________________ sidebar _____________________
        </tal:block>
        <td class="left"
          tal:define="template_id string:tab_edit">
          <metal:block use-macro="view/macro_vein_navigation/macros/vein" />
        </td>

        <tal:block replace="nothing">
          _____________________ main _____________________
        </tal:block>
        <td class="main">


  <form action="." name="silvaObjects" method="POST">
    <table class="listing">
      <thead>
        <tal:block replace="nothing">
          ______________ vein + title row ______________
        </tal:block>
        <tr>
          <td class="top"
            colspan="3">
            <h2>
              <img tal:replace="structure python:view.render_icon(model)" />
              <span style="text-transform:lowercase;"
                tal:content="model/meta_type">Meta type</span> 
              &#xab;<tal:block content="model/get_title_or_id" />&#xbb;
              <span i18n:translate="">settings</span>
            </h2>
          </td>
        </tr>
      </thead>

      <span tal:replace="nothing"> ______________ table header ______________ </span>
      <tbody>
        <tr tal:condition="python:len(sources) != 0">
          <th class="align-right" width="3%" nowrap="1" i18n:translate="">element</th>
          <th i18n:translate="">content</th>
          <th width="40%" i18n:translate="">note</th>
        </tr>

        <span tal:replace="nothing"> -------------- form content ------------- </span>
        <tal:block tal:repeat="field fields">
          <tr class="even" tal:attributes="class python: test(repeat['field'].odd(), 'odd', 'even')">
            <td class="field-title">
              <nobr>
                <span tal:replace="field/title">Title</span><span class="warning" tal:condition="field/is_required">*</span>
              </nobr>
            </td>
            <td tal:content="structure field/render">
              Field
            </td>
            <td tal:content="field/description">
              Description
            </td>
          </tr>
        </tal:block>

      </tbody>

      <tfoot>
        <tr class="controls">
          <td class="align-right"
            colspan="4">
            <input class="button" 
              type="submit"
              name="submit_settings:method"
              value="save settings"
              title="access key: alt-s"
              accesskey="s"
              i18n:attributes="title;value"
            />
          </td>
        </tr>
      </tfoot>

    </table>
  </form>

  <form action="." name="silvaObjects" method="POST">
    <table class="listing">
      <thead>
        <tal:block replace="nothing">
          ______________ vein + title row ______________
        </tal:block>
        <tr>
          <td class="top"
            colspan="3">
            <h2>
              <img tal:replace="structure python:view.render_icon(model)" />
              &#xab;<tal:block content="model/get_title_or_id" />&#xbb;
              <span  i18n:translate="">sources</span>
            </h2>
          </td>
        </tr>
      </thead>

      <span tal:replace="nothing"> ______________ table header ______________ </span>
      <tbody>
        <tr tal:condition="python:len(sources) != 0">
          <th i18n:translate="" width="3%">in use</th>
          <th i18n:translate="">id</th>
          <th i18n:translate="" width="40%">title</th>
        </tr>

        <span tal:replace="nothing"> ______________ listing iteration ______________ </span>
        <toc_entry tal:omit-tag=""
          tal:repeat="source sources">
          <tal:define define="obj source/object;
                              id source/index;
                              object obj/getObject;
                              object_path obj/getPath;
                              object_url python:object.absolute_url();
                              ">
            <cycle tal:define="oddrow repeat/source/odd" tal:omit-tag="">
              <tr class="even"
                tal:attributes="class python:test(oddrow, 'odd', 'even')">

                <span tal:replace="nothing"> _______ checkbox + icon _______ </span>
                <td nowrap="1">
                  <input type="checkbox" name="cb:list" value="value"
                      tal:attributes="value string:cb_${id}; checked source/check_checkbox" />
                  <a href="edit" title="edit this news source" i18:attributes="title"
                      tal:attributes="href string:${object_url}/edit/tab_edit"><img tal:replace="structure python:view.render_icon(object)" /></a>
                </td>

                <span tal:replace="nothing"> _______ id cell _______ </span>
                <td>
                  <a title="Edit this item" i18n:attributes="title"
                    tal:attributes="href string:${object_url}/edit/tab_edit"
                    tal:content="object_path">id</a>
                </td>

                <span tal:replace="nothing"> _______ title cell _______ </span>
                <td>
                  <tal:block condition="python:object.get_title_or_id() != ''">
                    <span tal:replace="structure string:${object/get_title_or_id}">title</span>
                  </tal:block>
                  <span class="warning" tal:condition="not: source/check_checkbox">
                    &nbsp;<tal:i18n i18n:translate="">(not activated)</tal:i18n>
                  </span>
                  <tal:block condition="python:obj.get_title == ''">
                    &nbsp;
                  </tal:block>
                </td>

              </tr>

            </cycle>
          </tal:define>
        </toc_entry>

        <span tal:replace="nothing"> ______________ if no records ______________ </span>
        <check tal:condition="python:len(sources) == 0 and not model.get_default()">
          <tr class="focus-light">
            <td i18n:translate="" colspan="3">
              There are no news sources available.
            </td>
          </tr>
          <tr class="divider">
            <td colspan="3">
              <img tal:attributes="src string:${silva_root}/globals/pixel.gif" width="1" height="1" />
            </td>
          </tr>
        </check>
        <!-- /iteration -->

      </tbody>

      <tfoot>
        <check tal:condition="python:len(sources) != 0">

          <span tal:replace="nothing"> ______________ controls for chief ______________ </span>
          <tr class="controls"
            tal:condition="python:user_role == 'Editor'">
            <td colspan="3" class="align-right">
              <input style="display: none"
                      id="select_all_button"
                      class="button" 
                      type="submit" 
                      name="selectButton" 
                      value="select all" 
                      sel_value="select all"
                      desel_value="deselect all"
                      title="select all items: alt-a" 
                      accesskey="a" 
                      onClick="toggleSelect(this); return false"
                      i18n:attributes="value;sel_value;desel_value;title">
              <script type="text/javascript">
              // <![CDATA[

                if (document.forms[0]) {
                  document.getElementById('select_all_button').style.display = 'inline';
                }

                isSelected = false;

                function toggleSelect(button) {
                  var form = button.form;
                  var check = true;
                  if (isSelected) {
                    check = false;
                    isSelected = false;
                  } else {
                    isSelected = true;
                  };
                  var inputs = form.getElementsByTagName('input');
                  for (var i=0; i < inputs.length; i++) {
                    var child = inputs[i];
                    var type = child.getAttribute('type');
                    if (type != 'radio' && type != 'checkbox') {
                      continue;
                    };
                    if (check) {
                      child.setAttribute('checked', true);
                    } else {
                      // make very sure the checkbox is unchecked, the 
                      // setAttribute works on IE but not on Moz, the 
                      // removeAttribute the other way round, this doesn't
                      // seem to clash and who knows IE 8 will require both ;)
                      child.setAttribute('checked', null);
                      child.removeAttribute('checked');
                    };
                  };
                  var newvalue = isSelected ? button.getAttribute('desel_value') :
                                  button.getAttribute('sel_value');
                  button.setAttribute('value', newvalue);
                };
                
              // ]]>
              </script>
              &nbsp;
              <input type="hidden" name="start" tal:attributes="value startat">
              <input class="button" type="submit" name="use_sources:method" value="update sources" title="use selected sources in this filter: alt-u" accesskey="u" i18n:attributes="value;title"/>
            </td>
          </tr>

        </check>
      </tfoot>

    </table>
  </form>

<table width="50%">
  <tr>
    <td width="50%" align="left">
      &nbsp;
      <a href="#" tal:attributes="href string:${model/absolute_url}/edit/tab_edit?start:int=${previous/first}" tal:condition="previous" i18n:translate="">Previous</a>
    </td>
    <td width="50%" align="right">
      &nbsp;
      <a href="#" tal:attributes="href string:${model/absolute_url}/edit/tab_edit?start:int=${next/first}" tal:condition="next" i18n:translate="">Next</a></td>
  </tr>
</table>

</html>
