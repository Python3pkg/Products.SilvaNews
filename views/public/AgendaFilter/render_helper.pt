<tal:block define="global view here;
                  global months view/get_months;
                  global currentmonth request/month | view/currentmonth;
                  global currentyear request/year | view/currentyear;
                  global results python:view.search_agenda(currentmonth, currentyear);
                  global objects python:[item.getObject() for item in results];
                  global model here/REQUEST/model;
                  global user_role view/get_user_role;
                  global silva_root view/silva_root;
                  global mangle modules/Products/Silva/mangle;
                  " />

<div class="margins">
<h2>Manage <span class="folder-title" tal:content="structure string:&raquo;${model/get_title}&laquo;">title here</span></h2>
</div>

<table width="100%" border="0">
<tr>
<td><a href="3" tal:content="python: '<< %s' % str(int(currentyear) - 1)" tal:attributes="href python:'?month=%s&year=%s' % (currentmonth, int(currentyear) - 1)">2001</a></td>
<tal:repeat repeat="month months">
<td align="center" tal:attributes="style python:test(month == currentmonth, 'border: 1px solid #666666;;', '');">
<a href="#" tal:content="month" tal:attributes="href python: '?month=%s&year=%s' % (month, currentyear)"></a></td>
</tal:repeat>
<td><a href="3" tal:content="python: '%s >>' % str(int(currentyear) + 1)" tal:attributes="href python:'?month=%s&year=%s' % (currentmonth, int(currentyear) + 1)">2003</a></td>
</tr>
</table>

<tal:comment condition="nothing">Begin PublicationTable</tal:comment>

<form action="." name="silvaObjects" method="POST">

<table width="100%" cellspacing="0" cellpadding="3" border="0" class="plain">


<span tal:replace="nothing"> ______________ table header ______________ </span>
<tr tal:condition="python:len(objects) != 0 or model.get_default()">
<th align="left" width="3%" nowrap="1">Type</th>
<th align="left" width="12%">Edit</th>
<th align="left">Preview</th>
<th align="right" width="12%" nowrap="1">New&nbsp;version<img tal:attributes="src string:${silva_root}/globals/pixel.gif" width="16" height="8" border="0" /></th>
<th align="left" width="9%">Publish&nbsp;date&nbsp;</th>
<th align="right" width="8%">Doc&nbsp;</th>
</tr>

<span tal:replace="nothing"> ______________ listing iteration ______________ </span>
<toc_entry tal:omit-tag=""
  tal:repeat="result results">
<tal:define define="obj result/getObject">
<cycle tal:define="oddrow repeat/result/odd" tal:omit-tag="">
<tr class="focus-cycle"
  tal:define="indent python:0;
              item python:obj;
              ref python:model.create_ref(item)"
  tal:attributes="class python:test(oddrow, 'focus', 'focus-cycle')">

<span tal:replace="nothing"> _______ checkbox + icon _______ </span>
<td nowrap="1">
<input type="checkbox" name="refs:list" value="value"
  tal:attributes="value ref; checked python:test(obj.in_source(view.absolute_url()), 'checked', '')" />
<a href="edit" title="Edit this item"
  tal:attributes="href string:${item/absolute_url}/edit/tab_edit">
<img tal:replace="structure python:view.render_icon(item)" />
</a>
</td>

<span tal:replace="nothing"> _______ id cell _______ </span>
<td valign="top">
<a title="Edit this item"
  tal:attributes="href string:${item/absolute_url}/edit;
                  class python:view.get_status_style(item)"
  tal:content="item/id">id
</a>
</td>

<span tal:replace="nothing"> _______ title cell _______ </span>
<td valign="top">
<tal:block condition="python:item.get_title() != ''">
<img style="height:100%" width="12" height="18" align="left"
  tal:attributes="width python:indent * 32 + 32;
 src string:${silva_root}/globals/pixel.gif" />
<a class="blacklink" title="Preview this item"
  tal:attributes="href string:${item/absolute_url}/edit/tab_preview"
  tal:condition="python:not item.get_container().meta_type == 'Silva Publication' or not item.id == 'index'">
<span tal:replace="structure string:${item/get_title}">title</span>
</a>
<a class="blacklink" title="Preview this item"
  tal:attributes="href string:${item/absolute_url}/edit/tab_preview"
  tal:condition="python:item.get_container().meta_type == 'Silva Publication' and item.id == 'index'">
<b tal:content="structure string:${item/get_title}">title</b>
</a>
</tal:block>
<tal:block condition="python:item.get_title() == ''">
&nbsp;
</tal:block>
</td>

<span tal:replace="nothing"> _______ version cell _______ </span>
<td align="right" valign="top">
<tal:block condition="item/implements_versioning">
<tal:block
  define="unpublished_status item/get_next_version_status;
  published_status item/get_public_version_status"
  condition="python:item.get_container().meta_type != 'Silva Publication' or item.id != 'index'">
<a class="redlink" title="Down to Publish tab of item"
  tal:condition="python:unpublished_status == 'not_approved'"
  tal:attributes="href string:${item/absolute_url}/edit/tab_status">Not&nbsp;approved</a>
<a class="greenlink" title="Down to Publish tab of item"
  tal:condition="python:unpublished_status == 'approved'"
  tal:attributes="href string:${item/absolute_url}/edit/tab_status">Approved</a>
<a class="bluelink" title="Down to Publish tab of item"
  tal:condition="python:unpublished_status == 'no_next_version' and published_status != 'closed'"
  tal:attributes="href string:${item/absolute_url}/edit/tab_status">None</a>
<a class="graylink" title="Down to Publish tab of item"
  tal:condition="python:unpublished_status == 'no_next_version' and published_status == 'closed'"
  tal:attributes="href string:${item/absolute_url}/edit/tab_status">None</a>
<img tal:attributes="src string:${silva_root}/globals/pixel.gif" width="16" height="16" border="0"
  tal:condition="python:item.id != 'index'" />
<a href="folder" title="Down to Publish tab of folder"
  tal:condition="python:item.id == 'index'"
  tal:attributes="href string:${item/absolute_url}/../edit/tab_status">
<img tal:attributes="src string:${silva_root}/globals/silvafolder.gif" width="16" height="16" border="0" alt="Down to Publish tab of folder" /></a>
</tal:block>
<span tal:replace="nothing">
<!-- this could be more efficient if we change get_status_tree (delete below and scrap condition above) -->
</span>
<tal:block condition="python:item.get_container().meta_type == 'Silva Publication' and item.id == 'index'">
<a class="graylink" title="Down to Publish tab of publication"
  tal:attributes="href string:${item/absolute_url}/../edit/tab_status">See
<img tal:attributes="src string:${silva_root}/globals/silvapublication.gif" width="16" height="16" border="0" alt="Down to Publish tab of folder" /></a>
</tal:block>
</tal:block>
&nbsp;
</td>

<span tal:replace="nothing"> _______ publish date cell _______ </span>
<td valign="top">
<tal:block condition="item/implements_versioning">
<span tal:condition="python:item.get_next_version_publication_datetime() != None"
  tal:replace="structure python:mangle.DateTime(item.get_next_version_publication_datetime()).toStr()" tal:omit-tag="">21 oct 2001 18:18</span>
<span tal:condition="python:item.get_next_version_publication_datetime() == None"
  tal:omit-tag="">&nbsp;</span>
</tal:block>
&nbsp;
</td>

<span tal:replace="nothing"> _______ public link cell _______ </span>
<td align="right">
<tal:block condition="item/implements_versioning">
<tal:block define="published_status item/get_public_version_status">
<a class="bluelink" href="public.html" title="See the public version"
  tal:condition="python:published_status == 'published'"
  tal:attributes="href string:${item/absolute_url}">Published</a>
<span tal:condition="python:published_status == 'no_public_version'"
  tal:replace="structure string:&nbsp;">None</span>
<span title="Public version is closed"
  tal:condition="python:published_status == 'closed'">Closed</span>
</tal:block>
</tal:block>
</td>

</tr>
</cycle>
</tal:define>
</toc_entry>

<span tal:replace="nothing"> ______________ if no records ______________ </span>
<check tal:condition="python:len(objects) == 0 and not model.get_default()">
<tr class="focus-light">
<td colspan="6">
There are no publishable objects in this folder.
</td>
</tr>
<tr class="divider">
<td colspan="6"><img tal:attributes="src string:${silva_root}/globals/pixel.gif" width="1" height="1" /></td>
</tr>
</check>
<!-- /iteration -->

<tal:comment condition="nothing">

<span tal:replace="nothing"> ______________ publish date setting______________ </span>
<tr class="controls" valign="top"
  tal:condition="python:len(objects) != 0 or model.get_default()">
<td align="right" colspan="3">
Publish time:&nbsp;
<field tal:replace="structure python:view.tab_status_form.publish_datetime.render()" />
</td>
<td align="right" colspan="3">
Set expiration time?&nbsp;
<field tal:replace="structure python:view.tab_status_form.expires_flag.render()" />
</td>
</tr>

<span tal:replace="nothing"> ______________ expiration date setting ______________ </span>
<tr class="controls-cycle" valign="top"
  tal:condition="python:len(objects) != 0 or model.get_default()">
<td align="right" colspan="3">
Expiration time:&nbsp;
<field tal:replace="structure python:view.tab_status_form.expiration_datetime.render()" />
</td>
<td align="right" colspan="3"
  tal:condition="python:user_role == 'Editor'">
Publish right now?&nbsp;
<field tal:replace="structure python:view.tab_status_form.publish_now_flag.render()" />
</td>
<td align="right" colspan="3"
  tal:condition="python:user_role == 'Author'">
&nbsp;
</td>
</tr>

<check tal:condition="python:len(objects) != 0 or model.get_default()">
<script type="text/javascript">
// <![CDATA[

  isSelected = false;

  function toggleSelect(button) {
    var form = button.form;
    var check = true;
    if (isSelected) {
      check = false;
      isSelected = false;
    } else {
      isSelected = true;
    };
    var inputs = form.getElementsByTagName('input');
    for (var i=0; i < inputs.length; i++) {
      var child = inputs[i];
      var type = child.getAttribute('type');
      if (type != 'radio' && type != 'checkbox') {
        continue;
      };
      if (check) {
        child.setAttribute('checked', true);
        button.setAttribute('value', 'deselect all');
      } else {
        // make very sure the checkbox is unchecked, the 
        // setAttribute works on IE but not on Moz, the 
        // removeAttribute the other way round, this doesn't
        // seem to clash and who knows IE 8 will require both ;)
        child.setAttribute('checked', null);
        child.removeAttribute('checked');
        button.setAttribute('value', 'select all');
      };
    };
  };
  
// ]]>
</script>

<span tal:replace="nothing"> ______________ controls for chief ______________ </span>
<tr class="controls"
  tal:condition="python:user_role == 'Editor'">
<td colspan="3">
<script type="text/javascript">
<!--
if (document.forms[0]) {
  document.write('<input class="button" type="submit" name="selectButton" value="Select all" title="Select all items on and below this level" onClick="toggleSelect(this); return false">')
  }
//-->
</script>
&nbsp;
<input class="button" type="submit" name="tab_status_revoke:method" value="Revoke approval" title="Withdraw approval of new versions" />
&nbsp;
<input class="warningbutton" type="submit" name="tab_status_close:method" value="Close" title="Close published items" />
&nbsp;
<input class="button" type="submit" name="download_xml:method" value="Export all" title="Export selected items" />
</td>
<td align="right" colspan="3" nowrap="1">
&nbsp;
<input class="button" type="submit" name="tab_status_new_version:method" value="Create new versions" title="Create new version" />
&nbsp;
<input class="button" type="submit" name="tab_status_change_settings:method" value="Change settings" title="Change publish and expiration times" />
&nbsp;
<input class="button" type="submit" name="tab_status_approve:method" value="Approve" title="Approve new versions" />
</td>
</tr>

<span tal:replace="nothing"> ______________ controls for author ______________ </span>
<tr class="controls"
  tal:condition="python:user_role == 'Author'">
<td colspan="3">
<script type="text/javascript">
<!--
if (document.forms[0]) {
  document.write('<input class="button" type="submit" name="selectButton" value="Select all" title="Select all items on and below this level" onClick="toggleSelect(); return false">')
  }
//-->
</script>
&nbsp;
<input class="button" type="submit" name="tab_status_revoke:method" value="Revoke approval" title="Withdraw approval of new versions" />
&nbsp;
<input class="button" type="submit" name="download_xml:method" value="Export all" title="Export selected items" />
</td>
<td align="right" colspan="3" nowrap="1">
&nbsp;
<input class="button" type="submit" name="tab_status_new_version:method" value="Create new versions" title="Create new version" />
&nbsp;
<input class="button" type="submit" name="tab_status_change_settings:method" value="Change settings" title="Change publish and expiration times" />
&nbsp;
<input class="button" type="submit" name="tab_status_request_approval:method" value="Request approval" title="Request approval for new versions" />
</td>
</tr>
</check>

</tal:comment>

<check tal:condition="python:len(objects) != 0 or model.get_default()">
<script type="text/javascript">
// <![CDATA[

  isSelected = false;

  function toggleSelect(button) {
    var form = button.form;
    var check = true;
    if (isSelected) {
      check = false;
      isSelected = false;
    } else {
      isSelected = true;
    };
    var inputs = form.getElementsByTagName('input');
    for (var i=0; i < inputs.length; i++) {
      var child = inputs[i];
      var type = child.getAttribute('type');
      if (type != 'radio' && type != 'checkbox') {
        continue;
      };
      if (check) {
        child.setAttribute('checked', true);
        button.setAttribute('value', 'deselect all');
      } else {
        // make very sure the checkbox is unchecked, the 
        // setAttribute works on IE but not on Moz, the 
        // removeAttribute the other way round, this doesn't
        // seem to clash and who knows IE 8 will require both ;)
        child.setAttribute('checked', null);
        child.removeAttribute('checked');
        button.setAttribute('value', 'select all');
      };
    };
  };
  
// ]]>
</script>

<span tal:replace="nothing"> ______________ controls for chief ______________ </span>
<tr class="controls"
  tal:condition="python:user_role == 'Editor'">
<td colspan="3">
<script type="text/javascript">
<!--
if (document.forms[0]) {
  document.write('<input class="button" type="submit" name="selectButton" value="Select all" title="Select all items on and below this level" onClick="toggleSelect(this); return false">')
  }
//-->
</script>
&nbsp;
<input class="button" type="submit" name="source_add:method" value="Use items" title="Use selected items in this source" />
&nbsp;
</td>
<td align="right" colspan="3" nowrap="1">
&nbsp;
</td>
</tr>

</check>

</table>

</form>

<table width="100%" border="0">
<tr>
<td><a href="3" tal:content="python: '<< %s' % str(int(currentyear) - 1)" tal:attributes="href python:'?month=%s&year=%s' % (currentmonth, int(currentyear) - 1)">2001</a></td>
<tal:repeat repeat="month months">
<td align="center" tal:attributes="style python:test(month == currentmonth, 'border: 1px solid #666666;;', '');">
<a href="#" tal:content="month" tal:attributes="href python: '?month=%s&year=%s' % (month, currentyear)"></a></td>
</tal:repeat>
<td><a href="3" tal:content="python: '%s >>' % str(int(currentyear) + 1)" tal:attributes="href python:'?month=%s&year=%s' % (currentmonth, int(currentyear) + 1)">2003</a></td>
</tr>
</table>
