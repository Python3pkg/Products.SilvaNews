<html tal:omit-tag=""
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:notal="http://www.infrae.com/silva/notal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  i18n:domain="silva_news"
  tal:define="
    view here;
    model view/REQUEST/model;
    results python:model.get_items();
    silva_root view/silva_root;
    formatdate nocall:view/service_news/format_date;
">

<h2 class="heading" tal:content="model/get_title">View News</h2>

<div class="searchbox">
  <form tal:attributes="action model/absolute_url" method="post">
    <input type="text" name="query" />
    <input class="button"
      type="submit"
      value="Search"
      title="Do a full text search: alt-s"
      accesskey="s"
      i18n:attributes="title;value"
    />
  </form>
</div>

<div class="newsitem" tal:repeat="object results">
  <tal:def define="obj object/getObject">
    <h3 class="heading newsitemheading" tal:content="structure obj/get_title">article title</h3>

    <div class="newsiteminfo">
      <p class="p creationdate"
        tal:define="creationdate python: formatdate(obj.get_metadata_element('silva-extra', 'creationtime'))"
        tal:condition="python: creationdate != ''"
        tal:content="structure creationdate">
        creation date
      </p>

      <p class="p eventdates"
          tal:define="startdate obj/start_datetime | nothing;
                      enddate obj/end_datetime | nothing"
          tal:condition="python: startdate or enddate">
        <tal:if condition="obj/start_datetime | nothing">
          <span tal:omit-tag="" i18n:translate="">Start:</span>
          <tal:insert replace="structure python: formatdate(obj.start_datetime(), obj.display_time())">
            start date
          </tal:insert>
        </tal:if>
        <tal:if condition="obj/end_datetime | nothing"><br />
          <span tal:omit-tag="" i18n:translate="">End:</span>
          <tal:insert replace="structure python: formatdate(obj.end_datetime(), obj.display_time())">
            end date
          </tal:insert>
        </tal:if>
      </p>
    </div>

    <div class="newsintro">
      <img 
        tal:define="classname python: test(repeat['object'].odd(), 'newsitem-thumbnail-odd', 'newsitem-thumbnail-even')"
        tal:replace="structure python: obj.get_thumbnail(classname)"
        tal:attributes="alt string:news article thumbnail image"
      />
      <tal:insert replace="structure obj/get_intro">
        intro text
      </tal:insert>
    </div>

    <p class="p articlelink">
      <a href="#" tal:attributes="href python:obj.get_content().absolute_url()" i18n:translate="">
        view article
      </a>
    </p>
  </tal:def>
</div>

<p class="p newsmessage"
  tal:condition="python: len(results) < 1"
  i18n:translate="">
  There are no articles available.
</p>

  <p class="p archivelink">
    <a tal:attributes="href string:?view=view_archive"
     i18n:translate="">
     view archive
   </a>
  </p>

</html>
