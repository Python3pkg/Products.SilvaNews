<div
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  i18n:domain="silva_news"

  tal:define="currentmonth request/month | options/month | view/currentmonth;
              currentyear request/year | options/year | view/currentyear;
              dummy python:context.year_in_range_trigger(int(currentyear));
              months view/get_months;
              results python:context.get_items_by_date(currentmonth, currentyear);
              offset python:int(request.get('offset', 0));
              batch_size context/number_to_show_archive;
              batch python:modules['ZTUtils'].Batch(results, size=batch_size, start=offset);
              previous batch/previous;
              next batch/next;
              user_role view/get_user_role;
              formatdate nocall:context/service_news/format_date;
              "
>

  <h2 class="heading" i18n:translate="">
    Archive of <tal:block i18n:name="title" tal:content="context/get_title" />
  </h2>

  <tal:block define="toporbottom string:top">
    <metal:macro define-macro="timetable">
     <table tal:define="toporbottom toporbottom|string:"
            tal:attributes="class string:timetable $toporbottom">
     <tbody>
      <tr class="even">
       <td>
        <a tal:condition="python:context.year_in_range(int(currentyear)-1)"
           tal:attributes="href python:'?month=%s&year=%s&view=view_archive' % (currentmonth, int(currentyear) - 1)">
          <span class="previous">&laquo;&nbsp;</span><span tal:content="structure python:str(int(currentyear) - 1)" />
         </a>
       </td>
       <tal:repeat repeat="month months">
        <tal:define define="id repeat/month/index">
          <td tal:condition="python:context.year_in_range(int(currentyear)-1) and repeat['month'].start" class="vertical-separator"> | </td>
          <td align="center" tal:attributes="class python: id == int(currentmonth) - 1 and 'selected_month' or '';">
          <a tal:content="month" 
             tal:attributes="href python: '?month=%s&year=%s&view=view_archive' % (id + 1, currentyear)" />
         </td>
         <td class="vertical-separator" tal:condition="python:  context.year_in_range(int(currentyear)+1) or not repeat['month'].end"> | </td>
         </tal:define>
       </tal:repeat>
       <td>
        <a tal:condition="python:context.year_in_range(int(currentyear)+1)"
           tal:attributes="href python:'?month=%s&year=%s&view=view_archive' % (currentmonth, int(currentyear) + 1)">
         <span tal:content="structure python:str(int(currentyear) + 1)" /><span class="next">&nbsp;&raquo;</span>
        </a>
       </td>
      </tr>
     </tbody>
    </table>
    </metal:macro>
  </tal:block>

  <div class="offsetnav"
     tal:condition="python: previous or next"
      >
    <tal:block tal:condition="previous">
      <a tal:attributes="href view/previous_url">previous</a>&amp;nbsp;
    </tal:block>
    <a tal:condition="next" tal:attributes="href view/next_url">next</a>
  </div>

  <tal:comment condition="nothing">Begin items</tal:comment>

  <div class="newsitem" tal:repeat="r batch">
    <div tal:define="obj r/getObject" tal:replace="structure obj/search_result" />
  </div>

  <p class="p newsmessage" tal:condition="python: len(batch) < 1" i18n:translate="">
    There are no articles available
  </p>

  <tal:comment condition="nothing">End items</tal:comment>

  <div class="offsetnav"
      tal:condition="python: previous or next"
      >
    <tal:block tal:condition="previous">
      <a tal:attributes="href view/previous_url">previous</a>&amp;nbsp;
    </tal:block>
    <a tal:condition="next" tal:attributes="href view/next_url()">next</a>
  </div>

  <tal:block define="toporbottom string:bottom">
    <metal:macro use-macro="template/macros/timetable" />
  </tal:block>

  <p class="p viewlink">
    <a href="#" tal:attributes="href context/absolute_url" i18n:translate="">view news</a>
  </p>

</div>
